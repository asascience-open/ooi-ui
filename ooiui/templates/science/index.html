{% extends "common/base.html" %}

{% block title %}
  <title>OOI Science</title>
{% endblock %}

{% block head %}
  <link href="/css/compiled/index.css" rel="stylesheet" type="text/css" />

  <script src='https://www.google.com/jsapi'></script>

  <!-- partials -->
  <script src="/js/partials/compiled/index.js" type="text/javascript"></script>
  <!-- d3 can't be concatenated easily -->
  <script src="/lib/d3/d3.min.js" type="text/javascript"></script>
  <script src="/js/compiled/index.js" type="text/javascript"></script>

  <script src="/js/partials/compiled/plotsDemo.js" type="text/javascript"></script>
  <script src="/js/compiled/plotsDemo.js" type="text/javascript"></script>



{% endblock %}


{% block body %}

<!--/.TOP BAR END -->

<div id="wrapper">
  <!-- Sidebar -->
  <div id="sidebar-wrapper" class="navbar-default">
  </div>
  <!-- /#sidebar-wrapper -->

  <!-- Page Content -->
  <div id="page-content-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="panel">
            <div class="panel-heading">
              <strong><span class="fa fa-globe"></span> <span data-i18n="Data">Map Section</span></strong>
            </div> <!-- panel-heading -->
            <div class="panel-body">
              <div class="map-view" id='map'></div>
            </div> <!-- panel-body -->
          </div> <!-- panel -->
        </div> <!-- col-lg-12 -->
      </div> <!-- row -->
      <div class="row">
        <div  class="col-lg-8">            
          <div class='content'>                       
            <div id="plotContent">              
            </div>           

            <div>
              <label id="plotInstrument">CP02PMUO-WFP01-04-FLORTK000</label> 
            </div>
            <div>
              <label id="plotStream">flort_kn_stc_imodem_instrument</label> 
            </div>
             <div>
              <label id="plotVariableStream">raw_signal_cdom</label> 
            </div>

          </div>
        </div> <!-- col-lg-8 -->
        <div class="col-lg-4">
          <div class="panel">
            
            <div id="plotControls">
            </div>

            </div> <!-- panel-body -->
          </div> <!-- panel -->
        </div> <!-- col-lg-4 -->
      </div> <!-- row -->
    </div> <!-- container-fluid -->
  </div> <!-- page-content-wrapper -->
</div>



  <!-- /#wrapper -->

<!-- Menu Toggle Script -->
<script type="text/javascript">

_.extend(OOI.prototype, Backbone.Events, {
  login: new LoginModel(),
  models: {
  },
  collections: {
    arrays: new ArrayCollection(),
    platform_deployments: new PlatformDeploymentCollection()
  },
  views: {
  },
  start: function() {
    this.login.fetch({async: false}); // Doesn't actually make an ajax request
    this.views.navbar = new NavbarView();
    $('body').prepend(this.views.navbar.el);

    this.views.tocView = new TOCView({
      collection: this.collections.arrays
    });
    this.collections.arrays.fetch({reset: true});

    $('#sidebar-wrapper').html(this.views.tocView.el);

    this.views.mapView = new MapView({
      collection: this.collections.platform_deployments,
      el: $('#map')
    });

    if(!this.login.loggedIn()) {
      this.modalView = new ModalDialogView();
      $('.container-fluid').first().append(this.modalView.el);
      this.modalView.show({
        message: "INSERT WARRANTY HERE",
        ack: function() { console.log("Closed"); }
      });
    }
    this.listenTo(this, "login:success", this.onLogin);
    this.listenTo(this, "login:logout", this.onLogout);
    

    this.plotPanel = new PanelView({
      heading: 'Plot Section',
      body: "<div id=charts'>asdasdasdasdasd</div>",      
      icon:"fa fa-globe"
    });
    $('#plotContent').html(this.plotPanel.el);    

    this.plotControlPanel = new PanelView({
      heading: 'Plot Controls',
      body: "<div class='new-chart'><select id='type'></select><input id='title' placeholder='Title'></input><button id='add'>Add another chart</button></div>",      
      icon:"fa fa-bar-chart"
    });
    $('#plotControls').html(this.plotControlPanel.el);    

    var app = new ChartViews();    
    
  }

});
var ooi = new OOI();

$(document).ready(function() {
    ooi.start();
    $("body").tooltip({ selector: '[data-toggle=tooltip]' });
});
</script>
{% endblock %}
